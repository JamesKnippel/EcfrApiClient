containers:
  - name: client
    image: ${{ env.REGISTRY_NAME }}.azurecr.io/${{ env.CLIENT_IMAGE_NAME }}:${{ github.sha }}
    resources:
      cpu: 2
      memory: 4Gi
    probes:
      - type: liveness
        httpGet:
          path: /
          port: 80
        initialDelaySeconds: 10
        periodSeconds: 30
    ingress:
      external: true
      targetPort: 80
      transport: http

  - name: api
    image: ${{ env.REGISTRY_NAME }}.azurecr.io/${{ env.API_IMAGE_NAME }}:${{ github.sha }}
    env:
      - name: ASPNETCORE_ENVIRONMENT
        value: Production
      - name: ASPNETCORE_URLS
        value: http://+:80
    resources:
      cpu: 2
      memory: 4Gi
    probes:
      - type: liveness
        httpGet:
          path: /api/health
          port: 80
        initialDelaySeconds: 10
        periodSeconds: 30
    ingress:
      external: true
      targetPort: 80
      transport: http

scale:
  minReplicas: 1
  maxReplicas: 3
  rules:
    - name: http-rule
      http:
        metadata:
          concurrentRequests: "10"

networking:
  ingress:
    external:
      allowInsecure: false
    internal:
      allowInsecure: true
  restrictOutboundTraffic: false
